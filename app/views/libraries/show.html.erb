<div class="row-fluid">
  <div class="span9">
    <h1 class="title"><%= @library.display_name.localize -%></h1>
    <p id="notice"><%= notice %></p>

    <%= t('activerecord.attributes.library.name') -%>: <%= @library.name -%>
    <% unless @library.web? %>
      (ISIL: <%= @library.isil %>)
    <% end %>
  </p>

  <%- unless @library.web? -%>
  <p>
    <%= t('library.address') -%>: <%= @library.zip_code -%> <%= @library.address.localize -%>
    <br />
    <%= t('activerecord.attributes.library.telephone_number_1') -%>: <%= @library.telephone_number_1 -%>
    <%= t('activerecord.attributes.library.telephone_number_2') -%>: <%= @library.telephone_number_2 -%>
    <br />
    <%= t('activerecord.attributes.library.fax_number') -%>: <%= @library.fax_number -%>
  </p>
  <p>
    <%= @library.opening_hour -%>
  </p>
  <p>
    <%= @library.note -%>
  </p>

      <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a href="#tab1" data-toggle="tab"><%= t('library.map') -%></a></li>
        <li><a href="#tab2" data-toggle="tab"><%= t('library.staff') -%></a></li>
        <li><a href="#tab3" data-toggle="tab"><%= t('activerecord.models.shelf') -%></a></li>
        <% if defined?(EnjuEvent) %>
          <li><a href="#tab4" data-toggle="tab"><%= t('activerecord.models.event') -%></a></li>
        <% end %>
        <%- if can? :update, @library -%>
          <li><a href="#tab5" data-toggle="tab"><%= t('page.configuration') -%></a></li>
        <%- end -%>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="tab1">
          <%= render 'libraries/map', :library => @library if @library.latitude and @library.longitude -%>
        </div>
        <div class="tab-pane" id="tab2">
          <%- if @library.users.librarians.exists? -%>
            <ul>
              <%- @library.users.librarians.each do |librarian| -%>
                <li>
                  <%= link_to librarian.username, librarian -%>
                  <%- unless librarian.note.blank? -%>
                    <br />
                    <%= librarian.note -%>
                  <%- end -%>
                </li>
              <%- end -%>
            </ul>
          <%- end -%>
        </div>
        <div class="tab-pane" id="tab3">
          <table class="table table-striped index">
            <tr>
              <th><%= t('activerecord.models.shelf') -%></th>
              <th><%= t('library.number_of_item') -%></th>
              <th><%= t('activerecord.attributes.shelf.note') -%></th>
            </tr>
            <%- @library.shelves.each do |shelf| -%>
              <tr class="line<%= cycle("0", "1") -%>">
               <td>
                  <%= link_to shelf.display_name.localize, library_shelf_path(@library, shelf) -%>
                  <%- shelf.picture_files.each do |picture_file| -%>
                    <%= link_to image_tag('icons/picture.png', :size => '16x16', :alt => t('page.picture')), picture_file_path(picture_file, :format => :download), :rel => "shelf_#{h(shelf.id)}" -%>
                  <%- end -%>
                  <script type="text/javascript">
                    $(document).ready(function(){
                      $("a[rel='shelf_<%= shelf.id -%>']").colorbox({transition:"none", photo:true});
                    })
                  </script>
                </td>
                <td><%= shelf.items_count -%></td>
                <td><%= shelf.note -%></td>
              </tr>
            <%- end -%>
          </table>
        </div>

        <% if defined?(EnjuEvent) %>
          <div class="tab-pane" id="tab4">
            <h3><%= link_to t('activerecord.models.event'), library_events_path(@library) -%></h3>
            <div id="library_calendar" style="text-align:left">
              <%= render 'calendar' -%>
            </div>
          </div>
        <% end %>

        <%- if can? :update, @library -%>
          <div class="tab-pane" id="tab5">
            <h3><%= t('page.configuration') -%></h3>
            <p>
              <strong><%= t('activerecord.attributes.library.call_number_rows') -%>:</strong>
              <%= @library.call_number_rows -%>
            </p>

            <p>
              <strong><%= t('activerecord.attributes.library.call_number_delimiter') -%>:</strong>
              <%= @library.call_number_delimiter -%>
            </p>
          </div>
        <%- end -%>
      </div>
    <%- end -%>
  </div>

  <div class="span3">
    <ul>
      <%- if can? :update, @library -%>
        <li><%= link_to t('page.edit'), edit_library_path(@library) -%></li>
      <%- end -%>
      <%- if can? :create, Shelf and !@library.web? -%>
        <li><%= link_to t('page.new', :model => t('activerecord.models.shelf')), new_library_shelf_path(@library) -%></li>
      <%- end -%>
      <% if defined?(EnjuEvent) %>
        <%- if can? :create, Event and !@library.web? -%>
          <li><%= link_to t('page.new', :model => t('activerecord.models.event')), new_library_event_path(@library) -%></li>
        <%- end -%>
      <%- end -%>
      <li><%= link_to t('page.listing', :model => t('activerecord.models.library')), libraries_path -%></li>
    </ul>
  </div>
</div>
